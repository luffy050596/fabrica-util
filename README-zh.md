<div align="center">
  <h1>ğŸ›ï¸ FABRICA UTIL</h1>
  <p><em>ä¸º go-pantheon ç”Ÿæ€ç³»ç»Ÿæä¾›çš„ç»¼åˆå·¥å…·åº“</em></p>
</div>

<p align="center">
<a href="https://github.com/go-pantheon/fabrica-util/actions/workflows/test.yml"><img src="https://github.com/go-pantheon/fabrica-util/workflows/Test/badge.svg" alt="Test Status"></a>
<a href="https://github.com/go-pantheon/fabrica-util/releases"><img src="https://img.shields.io/github/v/release/go-pantheon/fabrica-util" alt="Latest Release"></a>
<a href="https://pkg.go.dev/github.com/go-pantheon/fabrica-util"><img src="https://pkg.go.dev/badge/github.com/go-pantheon/fabrica-util" alt="GoDoc"></a>
<a href="https://goreportcard.com/report/github.com/go-pantheon/fabrica-util"><img src="https://goreportcard.com/badge/github.com/go-pantheon/fabrica-util" alt="Go Report Card"></a>
<a href="https://github.com/go-pantheon/fabrica-util/blob/main/LICENSE"><img src="https://img.shields.io/github/license/go-pantheon/fabrica-util" alt="License"></a>
<a href="https://deepwiki.com/go-pantheon/fabrica-util"><img src="https://deepwiki.com/badge.svg" alt="Ask DeepWiki"></a>
</p>

> **è¯­è¨€**: [English](README.md) | [ä¸­æ–‡](README-zh.md)

## å…³äº Fabrica Util

Fabrica Util æ˜¯ä¸º go-pantheon ç”Ÿæ€ç³»ç»Ÿæä¾›çš„ç»¼åˆå·¥å…·åº“ï¼Œä¸ºæ‰€æœ‰ go-pantheon ç»„ä»¶æä¾›é€šç”¨åŠŸèƒ½ã€‚è¿™ä¸ªåº“å°è£…äº†å¯é‡ç”¨çš„ä»£ç æ¨¡å¼ã€ç®—æ³•å’Œè¾…åŠ©å‡½æ•°ï¼Œç¡®ä¿æ¸¸æˆæœåŠ¡å™¨å¾®æœåŠ¡æ¶æ„ä¸­çš„ä¸€è‡´æ€§ï¼Œé¿å…ä»£ç é‡å¤ã€‚

æ›´å¤šä¿¡æ¯è¯·æŸ¥çœ‹ï¼š[deepwiki/go-pantheon/fabrica-util](https://deepwiki.com/go-pantheon/fabrica-util)

## å…³äº go-pantheon ç”Ÿæ€ç³»ç»Ÿ

**go-pantheon** æ˜¯ä¸€ä¸ªå¼€ç®±å³ç”¨çš„æ¸¸æˆæœåŠ¡å™¨æ¡†æ¶ï¼ŒåŸºäº [go-kratos](https://github.com/go-kratos/kratos) å¾®æœåŠ¡æ¶æ„æä¾›é«˜æ€§èƒ½ã€é«˜å¯ç”¨çš„æ¸¸æˆæœåŠ¡å™¨é›†ç¾¤è§£å†³æ–¹æ¡ˆã€‚Fabrica Util ä½œä¸ºåŸºç¡€å·¥å…·åº“ï¼Œæ”¯æŒä»¥ä¸‹æ ¸å¿ƒç»„ä»¶ï¼š

- **Roma**ï¼šæ¸¸æˆæ ¸å¿ƒé€»è¾‘æœåŠ¡
- **Janus**ï¼šç½‘å…³æœåŠ¡ï¼Œå¤„ç†å®¢æˆ·ç«¯è¿æ¥å’Œè¯·æ±‚è½¬å‘
- **Lares**ï¼šè´¦æˆ·æœåŠ¡ï¼Œç”¨äºç”¨æˆ·è®¤è¯å’Œè´¦æˆ·ç®¡ç†
- **Senate**ï¼šåå°ç®¡ç†æœåŠ¡ï¼Œæä¾›è¿è¥ç®¡ç†æ¥å£

### æ ¸å¿ƒç‰¹æ€§

- ğŸ•’ **æ—¶é—´å·¥å…·**ï¼šé«˜çº§æ—¶é—´å¤„ç†ï¼Œæ”¯æŒå¤šè¯­è¨€ã€æ—¶åŒºç®¡ç†å’Œæ—¶é—´æ®µè®¡ç®—
- ğŸ”„ **å¹¶å‘å¤„ç†**ï¼šçº¿ç¨‹å®‰å…¨çš„åŒæ­¥åŸè¯­ï¼ŒåŒ…æ‹¬å»¶è¿Ÿå™¨ã€Future å’Œåç¨‹ç®¡ç†
- ğŸ” **å®‰å…¨æ¨¡å—**ï¼šå…¨é¢çš„åŠ å¯†å·¥å…·ï¼ˆAES-GCMã€RSAã€ECDHï¼‰ï¼Œç”¨äºå®‰å…¨æ•°æ®ä¼ è¾“
- ğŸ†” **ID ç®¡ç†**ï¼šåˆ†å¸ƒå¼ ID ç”Ÿæˆï¼Œæ”¯æŒåŒºåŸŸç¼–ç å’Œ HashID æ··æ·†
- ğŸ² **éšæœºåŒ–**ï¼šå®‰å…¨çš„éšæœºæ•°ç”Ÿæˆå’Œå­—ç¬¦ä¸²åˆ›å»ºå·¥å…·
- ğŸ“Š **æ•°æ®ç»“æ„**ï¼šé«˜æ€§èƒ½å®ç°ï¼ˆå¸ƒéš†è¿‡æ»¤å™¨ã€ä½å›¾ã€ä¸€è‡´æ€§å“ˆå¸Œï¼‰
- ğŸ§  **å†…å­˜ç®¡ç†**ï¼šå¤šæ± å†…å­˜ç®¡ç†ï¼Œä¼˜åŒ–èµ„æºåˆ©ç”¨
- ğŸ”¤ **å­—ç¬¦ä¸²å¤„ç†**ï¼šå¤§å°å†™è½¬æ¢å’Œæ–‡æœ¬å¤„ç†å·¥å…·
- âš ï¸ **é”™è¯¯å¤„ç†**ï¼šå¢å¼ºçš„é”™è¯¯å¤„ç†ï¼Œæ”¯æŒä¸Šä¸‹æ–‡å’Œå †æ ˆè·Ÿè¸ª

## å·¥å…·åŒ…

### æ—¶é—´å·¥å…· (`xtime/`)
æ”¯æŒå¤šè¯­è¨€çš„é«˜çº§æ—¶é—´å¤„ç†ï¼š
- å¯é…ç½®çš„æ—¶åŒºå’Œè¯­è¨€æ”¯æŒ
- æœ¬åœ°åŒ–æ—¶é—´æ ¼å¼è½¬æ¢
- æ—¥/å‘¨/æœˆå‘¨æœŸè®¡ç®—
- æ—¶åŒºè½¬æ¢å·¥å…·

### åŒæ­¥å·¥å…· (`xsync/`)
çº¿ç¨‹å®‰å…¨çš„åŒæ­¥åŸè¯­ï¼š
- **Delayer**ï¼šåŸºäºæ—¶é—´çš„ä»»åŠ¡è°ƒåº¦å’Œè¿‡æœŸç®¡ç†
- **Future**ï¼šå¼‚æ­¥è®¡ç®—ç»“æœ
- **Closure**ï¼šçº¿ç¨‹å®‰å…¨çš„å‡½æ•°æ‰§è¡ŒåŒ…è£…å™¨
- **Routines**ï¼šåç¨‹ç”Ÿå‘½å‘¨æœŸç®¡ç†

### ID ç”Ÿæˆ (`xid/`)
åˆ†å¸ƒå¼ ID ç®¡ç†ç³»ç»Ÿï¼š
- åŸºäºåŒºåŸŸçš„ ID ç»„åˆï¼Œæ”¯æŒå¤šåŒºåŸŸ
- HashID ç¼–ç /è§£ç ï¼Œç”¨äºå‰ç«¯æ˜¾ç¤º
- ID æ··æ·†ï¼Œæå‡å®‰å…¨æ€§

### å®‰å…¨æ¨¡å— (`security/`)
å…¨é¢çš„åŠ å¯†æ“ä½œï¼š
- **AES**ï¼šAES-GCM åŠ å¯†/è§£å¯†ï¼Œå®‰å…¨çš„éšæœºæ•°ç”Ÿæˆ
- **RSA**ï¼šå…¬é’¥/ç§é’¥æ“ä½œ
- **ECDH**ï¼šæ¤­åœ†æ›²çº¿ Diffie-Hellman å¯†é’¥äº¤æ¢
- **Certificate**ï¼šX.509 è¯ä¹¦å¤„ç†å·¥å…·

### æ•°æ®ç»“æ„
- **å¸ƒéš†è¿‡æ»¤å™¨** (`bloom/`)ï¼šå†…å­˜é«˜æ•ˆçš„é›†åˆæˆå‘˜æµ‹è¯•
- **ä½å›¾** (`bitmap/`)ï¼šä½çº§æ“ä½œï¼Œç´§å‡‘æ•°æ®å­˜å‚¨
- **ä¸€è‡´æ€§å“ˆå¸Œ** (`consistenthash/`)ï¼šè´Ÿè½½å‡è¡¡çš„åˆ†å¸ƒå¼å“ˆå¸Œç¯

### å…¶ä»–å·¥å…·
- **éšæœºæ•°** (`xrand/`)ï¼šåŠ å¯†å®‰å…¨çš„éšæœºæ•°ç”Ÿæˆ
- **å‹ç¼©** (`compress/`)ï¼šæ•°æ®å‹ç¼©å·¥å…·
- **é©¼å³°å‘½å** (`camelcase/`)ï¼šå­—ç¬¦ä¸²å¤§å°å†™è½¬æ¢å·¥å…·
- **å†…å­˜æ± ** (`multipool/`)ï¼šå†…å­˜æ± ç®¡ç†
- **é”™è¯¯å¤„ç†** (`errors/`)ï¼šå¢å¼ºçš„é”™è¯¯å¤„ç†ä¸ä¸Šä¸‹æ–‡

## æŠ€æœ¯æ ˆ

| æŠ€æœ¯/ç»„ä»¶         | ç”¨é€”                         | ç‰ˆæœ¬    |
| ----------------- | ---------------------------- | ------- |
| Go                | ä¸»è¦å¼€å‘è¯­è¨€                 | 1.23+   |
| crypto            | åŠ å¯†æ“ä½œ                     | v0.39.0 |
| go-redis          | Redis å®¢æˆ·ç«¯ï¼Œç”¨äºåˆ†å¸ƒå¼æ“ä½œ | v9.10.0 |
| PostgreSQL Driver | æ•°æ®åº“è¿æ¥                   | v5.7.5  |
| MongoDB Driver    | NoSQL æ•°æ®åº“æ“ä½œ             | v2.2.2  |
| HashIDs           | ID æ··æ·†åº“                    | v2.0.1  |
| Murmur3           | å¿«é€Ÿå“ˆå¸Œç®—æ³•                 | v1.1.0  |

## ç³»ç»Ÿè¦æ±‚

- Go 1.23+

## å¿«é€Ÿå¼€å§‹

### å®‰è£…

```bash
go get github.com/go-pantheon/fabrica-util
```

### åˆå§‹åŒ–å¼€å‘ç¯å¢ƒ

```bash
make init
```

### è¿è¡Œæµ‹è¯•

```bash
make test
```

## ä½¿ç”¨ç¤ºä¾‹

### å¤šè¯­è¨€æ—¶é—´å¤„ç†

```go
package main

import (
    "fmt"
    "time"

    "github.com/go-pantheon/fabrica-util/xtime"
)

func main() {
    // åˆå§‹åŒ–é…ç½®
    err := xtime.Init(xtime.Config{
        Language: "zh",
        Timezone: "Asia/Shanghai",
    })
    if err != nil {
        panic(err)
    }

    // æ ¼å¼åŒ–å½“å‰æ—¶é—´
    fmt.Println(xtime.Format(time.Now()))

    // è®¡ç®—ä¸‹æ¬¡æ¯æ—¥é‡ç½®æ—¶é—´ï¼ˆä¸Šåˆ5ç‚¹é‡ç½®ï¼‰
    nextReset := xtime.NextDailyTime(time.Now(), 5*time.Hour)
    fmt.Println("ä¸‹æ¬¡æ¯æ—¥é‡ç½®:", nextReset)

    // è·å–æœ¬å‘¨å¼€å§‹æ—¶é—´
    weekStart := xtime.StartOfWeek(time.Now())
    fmt.Println("æœ¬å‘¨å¼€å§‹:", weekStart)
}
```

### AES-GCM åŠ å¯†

```go
package main

import (
    "fmt"

    "github.com/go-pantheon/fabrica-util/security/aes"
)

func main() {
    // åˆ›å»º AES åŠ å¯†å™¨ï¼Œä½¿ç”¨ 32 å­—èŠ‚å¯†é’¥
    key := []byte("0123456789abcdef0123456789abcdef")
    cipher, err := aes.NewAESCipher(key)
    if err != nil {
        panic(err)
    }

    data := []byte("æ•æ„Ÿçš„æ¸¸æˆæ•°æ®")

    // åŠ å¯†æ•°æ®
    encrypted, err := cipher.Encrypt(data)
    if err != nil {
        panic(err)
    }

    // è§£å¯†æ•°æ®
    decrypted, err := cipher.Decrypt(encrypted)
    if err != nil {
        panic(err)
    }

    fmt.Printf("åŸå§‹æ•°æ®: %s\n", data)
    fmt.Printf("è§£å¯†æ•°æ®: %s\n", decrypted)
}
```

### åŸºäºåŒºåŸŸçš„ ID ç®¡ç†

```go
package main

import (
    "fmt"

    "github.com/go-pantheon/fabrica-util/xid"
)

func main() {
    // ç»„åˆåŒºåŸŸ ID å’ŒåŒºåŸŸç¼–å·
    playerID := int64(12345)
    zoneNum := uint8(3)
    combinedID := xid.CombineZoneID(playerID, zoneNum)

    // ç¼–ç  ID ç”¨äºå‰ç«¯æ˜¾ç¤º
    encodedID, err := xid.EncodeID(combinedID)
    if err != nil {
        panic(err)
    }
    fmt.Printf("ç¼–ç  ID: %s\n", encodedID)

    // è§£ç  ID
    decodedID, err := xid.DecodeID(encodedID)
    if err != nil {
        panic(err)
    }

    // åˆ†å‰² ID å›åˆ°åŸå§‹ç»„ä»¶
    originalPlayerID, originalZone := xid.SplitID(decodedID)
    fmt.Printf("ç©å®¶ ID: %d, åŒºåŸŸ: %d\n", originalPlayerID, originalZone)
}
```

### å»¶è¿Ÿå™¨åŒæ­¥

```go
package main

import (
    "fmt"
    "time"

    "github.com/go-pantheon/fabrica-util/xsync"
)

func main() {
    // åˆ›å»ºå»¶è¿Ÿå™¨
    delayer := xsync.NewDelayer()
    defer delayer.Close()

    // è®¾ç½®è¿‡æœŸæ—¶é—´ï¼ˆ5ç§’åï¼‰
    expiryTime := time.Now().Add(5 * time.Second)
    delayer.SetExpiryTime(expiryTime)

    fmt.Println("ç­‰å¾…å»¶è¿Ÿå™¨è¿‡æœŸ...")

    // ç­‰å¾…è¿‡æœŸ
    select {
    case <-delayer.Wait():
        fmt.Println("å»¶è¿Ÿå™¨å·²è¿‡æœŸï¼")
    case <-time.After(10 * time.Second):
        fmt.Println("ç­‰å¾…å»¶è¿Ÿå™¨è¶…æ—¶")
    }
}
```

## é¡¹ç›®ç»“æ„

```
.
â”œâ”€â”€ xtime/              # æ”¯æŒæœ¬åœ°åŒ–çš„æ—¶é—´å·¥å…·
â”œâ”€â”€ xsync/              # åŒæ­¥åŸè¯­
â”‚   â”œâ”€â”€ delayer.go      # åŸºäºæ—¶é—´çš„ä»»åŠ¡è°ƒåº¦
â”‚   â”œâ”€â”€ future.go       # å¼‚æ­¥è®¡ç®—
â”‚   â”œâ”€â”€ closure.go      # çº¿ç¨‹å®‰å…¨å‡½æ•°åŒ…è£…å™¨
â”‚   â””â”€â”€ routines.go     # åç¨‹ç®¡ç†
â”œâ”€â”€ xrand/              # å®‰å…¨éšæœºæ•°ç”Ÿæˆ
â”œâ”€â”€ xid/                # ID ç”Ÿæˆå’Œæ··æ·†
â”œâ”€â”€ security/           # åŠ å¯†æ“ä½œ
â”‚   â”œâ”€â”€ aes/            # AES-GCM åŠ å¯†
â”‚   â”œâ”€â”€ rsa/            # RSA åŠ å¯†
â”‚   â”œâ”€â”€ ecdh/           # æ¤­åœ†æ›²çº¿ Diffie-Hellman
â”‚   â””â”€â”€ certificate/    # X.509 è¯ä¹¦å·¥å…·
â”œâ”€â”€ consistenthash/     # ä¸€è‡´æ€§å“ˆå¸Œå®ç°
â”œâ”€â”€ multipool/          # å†…å­˜æ± ç®¡ç†
â”œâ”€â”€ errors/             # å¢å¼ºé”™è¯¯å¤„ç†
â”œâ”€â”€ bloom/              # å¸ƒéš†è¿‡æ»¤å™¨å®ç°
â”œâ”€â”€ compress/           # æ•°æ®å‹ç¼©å·¥å…·
â”œâ”€â”€ bitmap/             # ä½å›¾æ•°æ®ç»“æ„
â””â”€â”€ camelcase/          # å­—ç¬¦ä¸²å¤§å°å†™è½¬æ¢
```

## ä¸ go-pantheon ç»„ä»¶é›†æˆ

Fabrica Util è®¾è®¡ç”¨äºè¢«å…¶ä»– go-pantheon ç»„ä»¶å¯¼å…¥ï¼š

```go
import (
    // Lares ä¸­ç”¨äºä»¤ç‰Œç”Ÿæˆçš„å®‰å…¨å·¥å…·
    "github.com/go-pantheon/fabrica-util/security/aes"

    // Roma ä¸­ç”¨äºæ¸¸æˆé€»è¾‘çš„æ—¶é—´å·¥å…·
    "github.com/go-pantheon/fabrica-util/xtime"

    // Janus ä¸­ç”¨äºè¿æ¥å¤„ç†çš„åŒæ­¥å·¥å…·
    "github.com/go-pantheon/fabrica-util/xsync"

    // åˆ†å¸ƒå¼ç©å®¶èº«ä»½è¯†åˆ«çš„ ID ç®¡ç†
    "github.com/go-pantheon/fabrica-util/xid"
)
```

## å¼€å‘æŒ‡å—

### è®¸å¯è¯åˆè§„

é¡¹ç›®å¯¹æ‰€æœ‰ä¾èµ–é¡¹å¼ºåˆ¶æ‰§è¡Œè®¸å¯è¯åˆè§„ã€‚æˆ‘ä»¬åªå…è®¸ä»¥ä¸‹è®¸å¯è¯ï¼š
- MIT
- Apache-2.0
- BSD-2-Clause
- BSD-3-Clause
- ISC
- MPL-2.0

è®¸å¯è¯æ£€æŸ¥åœ¨ä»¥ä¸‹æƒ…å†µæ‰§è¡Œï¼š
- CI/CD æµæ°´çº¿ä¸­è‡ªåŠ¨æ‰§è¡Œ
- é€šè¿‡é¢„æäº¤é’©å­åœ¨æœ¬åœ°æ‰§è¡Œ
- ä½¿ç”¨ `make license-check` æ‰‹åŠ¨æ‰§è¡Œ

### æµ‹è¯•

è¿è¡Œå®Œæ•´çš„æµ‹è¯•å¥—ä»¶ï¼š

```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•å¹¶ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š
make test

# è¿è¡Œä»£ç æ£€æŸ¥
make lint

# è¿è¡Œ go vet
make vet
```

### æ·»åŠ æ–°å·¥å…·

æ·»åŠ æ–°çš„å·¥å…·å‡½æ•°æ—¶ï¼š

1. æ ¹æ®åŠŸèƒ½åˆ›å»ºæ–°åŒ…æˆ–æ·»åŠ åˆ°ç°æœ‰åŒ…ä¸­
2. å®ç°å…·æœ‰é€‚å½“é”™è¯¯å¤„ç†çš„å·¥å…·å‡½æ•°
3. ç¼–å†™æ¶µç›–è¾¹ç•Œæƒ…å†µçš„å…¨é¢å•å…ƒæµ‹è¯•
4. ç”¨æ¸…æ™°çš„ç¤ºä¾‹è®°å½•ä½¿ç”¨æ–¹æ³•
5. ç¡®ä¿é€‚ç”¨æ—¶çš„çº¿ç¨‹å®‰å…¨
6. è¿è¡Œæµ‹è¯•ï¼š`make test`
7. å¦‚éœ€è¦ï¼Œæ›´æ–°æ–‡æ¡£

### è´¡çŒ®æŒ‡å—

1. Fork è¿™ä¸ªä»“åº“
2. ä» `main` åˆ†æ”¯åˆ›å»ºåŠŸèƒ½åˆ†æ”¯
3. å®ç°å¸¦æœ‰å…¨é¢æµ‹è¯•çš„æ›´æ”¹
4. ç¡®ä¿æ‰€æœ‰æµ‹è¯•é€šè¿‡ä¸”ä»£ç æ£€æŸ¥æ¸…æ´
5. æ›´æ–°ä»»ä½• API æ›´æ”¹çš„æ–‡æ¡£
6. æäº¤å¸¦æœ‰æ¸…æ™°æè¿°çš„ Pull Request

## æ€§èƒ½è€ƒè™‘

- **å†…å­˜æ± **ï¼šå¯¹äºé«˜é¢‘å¯¹è±¡åˆ†é…ï¼Œä½¿ç”¨ `multipool`
- **åŠ å¯†**ï¼šAES-GCM æ“ä½œé’ˆå¯¹ååé‡è¿›è¡Œäº†ä¼˜åŒ–
- **ID ç”Ÿæˆ**ï¼šHashID ç¼–ç é’ˆå¯¹é‡å¤æ“ä½œè¿›è¡Œäº†ç¼“å­˜
- **æ—¶é—´æ“ä½œ**ï¼šæ—¶åŒºåŠ è½½è¢«ç¼“å­˜å’Œé‡ç”¨
- **åŒæ­¥**ï¼šæ‰€æœ‰åŒæ­¥åŸè¯­éƒ½è®¾è®¡ä¸ºä½ç«äº‰

## è®¸å¯è¯

æœ¬é¡¹ç›®æ ¹æ® LICENSE æ–‡ä»¶ä¸­æŒ‡å®šçš„æ¡æ¬¾è·å¾—è®¸å¯ã€‚
